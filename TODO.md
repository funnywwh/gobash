# gobash 未完成任务清单

## 🔴 代码中的TODO项（需要修复/完善）

### 1. ✅ exit命令的退出码解析 - **已完成**
**位置**: `internal/builtin/builtin.go:127`
**状态**: 已修复，现在可以正确解析退出码
**修复内容**: 使用 `strconv.Atoi` 解析退出码参数

```go
// 修复后的代码
func exit(args []string, env map[string]string) error {
    code := 0
    if len(args) > 0 {
        if parsed, err := strconv.Atoi(args[0]); err == nil {
            code = parsed
        }
    }
    os.Exit(code)
    return nil
}
```

### 2. ✅ for循环的位置参数支持 - **已完成**
**位置**: `internal/executor/executor.go:357`
**状态**: 已实现，支持 `for i; do ... done` 语法
**修复内容**: 从环境变量中读取位置参数（$1, $2, ...）并遍历

```go
// 修复后的代码
if len(stmt.In) == 0 {
    // 从环境变量中获取位置参数
    argCount := 0
    if countStr, ok := e.env["#"]; ok {
        fmt.Sscanf(countStr, "%d", &argCount)
    }
    // 遍历位置参数并执行循环体
    ...
}
```

### 3. ✅ set命令的选项实现 - **已完成**
**位置**: `internal/builtin/builtin.go:186` 和 `internal/shell/shell.go`
**状态**: 已实现，支持 `set -x`, `set -e`, `set +x`, `set +e` 等选项
**修复内容**: 
- 在Shell结构体中添加options字段存储选项状态
- 在Executor中添加选项支持，实现 `-x`（显示执行的命令）和 `-e`（遇到错误立即退出）
- 在Shell中直接处理set命令，支持设置/取消设置选项

**支持的选项**:
- `set -x` / `set +x`: 显示/隐藏执行的命令（xtrace）
- `set -e` / `set +e`: 遇到错误立即退出/继续执行（errexit）
- `set -xe`: 可以组合多个选项
- `set`: 显示当前选项状态

## 🟡 可选增强功能（README中列出）

### 1. ✅ 箭头键浏览历史 - **已完成**
**状态**: 已实现
**实现**: 使用 `github.com/chzyer/readline` 库
**功能**: 
- 支持 ↑↓ 键浏览历史命令
- 自动保存历史到 ~/.gobash_history
- 如果readline不可用，自动回退到简单模式
**优先级**: 中
**难度**: ⭐⭐⭐ 需要外部库集成

### 2. ✅ 命令自动补全功能 - **已完成**
**状态**: 已实现
**实现**: 使用readline库的AutoComplete接口
**功能**: 
- Tab键补全内置命令
- Tab键补全别名
- Tab键补全PATH中的外部命令
- Tab键补全文件名（支持目录）
- Tab键补全环境变量（$VAR, ${VAR}格式）
**优先级**: 中
**难度**: ⭐⭐⭐⭐ 复杂

### 3. 更多Bash特性 - **部分完成**
**状态**: 部分实现
**已实现**:
- ✅ 命令替换（`` `command` `` 或 `$(command)`）- 已实现
- ✅ 算术展开（`$((expr))`）- 已实现

**未实现**:
- ⏳ 数组支持（`arr=(1 2 3)`）
- ⏳ 关联数组（`declare -A arr`）
- ⏳ 进程替换（`<(command)`, `>(command)`）

**优先级**: 低
**难度**: ⭐⭐⭐⭐⭐ 非常复杂

### 4. ✅ 作业控制 - **已完成**
**状态**: 已实现
**包括**:
- ✅ 后台任务（`command &`）- 已实现
- ✅ `fg` 命令（前台任务）- 已实现
- ✅ `bg` 命令（后台任务）- 已实现
- ✅ `jobs` 命令（显示作业列表）- 已实现
- ⚠️ `Ctrl+Z` 信号处理 - Windows平台限制，暂不支持

**实现内容**:
- 在 `internal/executor/jobs.go` 中实现了 `JobManager` 和 `Job` 结构体
- 在 `internal/builtin/jobs.go` 中实现了 `jobs`、`fg`、`bg` 命令
- 支持后台任务执行（`command &`）
- 支持查看作业列表（`jobs`）
- 支持将后台任务转到前台（`fg [job_id]`）
- 支持继续后台任务（`bg [job_id]`）

**注意**: Windows平台不支持 `Ctrl+Z` 信号处理，这是平台限制。

**优先级**: 中
**难度**: ⭐⭐⭐⭐ 复杂（需要信号处理）

### 5. ✅ 更多测试用例和文档 - **部分完成**
**状态**: 已添加示例脚本和使用文档
**已完成**:
- ✅ 示例脚本（basic.sh, text_processing.sh, advanced.sh）
- ✅ 使用文档（README_EXAMPLES.md）
- ⏳ 单元测试（待实现）
- ⏳ 集成测试（待实现）
- ⏳ API文档（待实现）

**优先级**: 中
**难度**: ⭐⭐ 中等

### 6. ✅ 更多内置命令 - **已完成**
**状态**: 所有计划的内置命令已实现
**已实现**:
- `head` - 显示文件的前几行 ✅
- `tail` - 显示文件的后几行 ✅
- `wc` - 统计行数、字数、字符数 ✅
- `grep` - 文本搜索 ✅
- `sort` - 排序 ✅
- `uniq` - 去重 ✅
- `cut` - 剪切字段 ✅

**优先级**: 中
**难度**: ⭐⭐ 中等

## 📊 优先级建议

### 高优先级（建议先完成）
1. ✅ **exit命令的退出码解析** - 简单且常用
2. ✅ **for循环的位置参数支持** - 常用Bash语法

### 中优先级（可选）
3. ✅ **set命令的选项实现** - 部分常用
4. ✅ **箭头键浏览历史** - 提升用户体验
5. ✅ **作业控制** - 实用功能

### 低优先级（未来考虑）
6. ✅ **命令自动补全** - 复杂但有用
7. ⚠️ **更多Bash特性** - 逐步实现
8. ⏳ **测试和文档** - 持续改进（部分完成）

## 📝 总结

### 已完成的主要功能
- ✅ 所有核心功能（词法分析、语法分析、执行器）
- ✅ 所有计划的内置命令（包括文本处理命令）
- ✅ 作业控制（jobs, fg, bg）- 已修复并优化
- ✅ 命令历史和自动补全
- ✅ Shell选项（set命令：-x, -e, -u等）
- ✅ 命令替换和算术展开
- ✅ 示例脚本和文档

### 最近完成的改进
- ✅ 修复了fg命令中的进程Wait问题（避免重复Wait）
- ✅ 优化了作业管理的goroutine实现
- ✅ 改进了代码质量和错误处理

### 待实现的功能
- ⏳ 单元测试和集成测试
- ⏳ API文档
- ⏳ 更多Bash特性（数组、关联数组、进程替换等）

### 平台限制
- ⚠️ Windows平台不支持 `Ctrl+Z` 信号处理（平台限制）

